<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Subdivision Development Proforma</title>
<style>
  body {
    font-family: Arial, sans-serif; 
    margin: 20px;
  }
  table {
    border-collapse: collapse; 
    width: 100%; 
    margin-bottom: 30px;
    table-layout: fixed;
  }
  th, td {
    border: 1px solid #ccc; 
    padding: 8px; 
    vertical-align: top;
  }
  th {
    background: #f0f0f0;
    text-align: left;
  }
  input, select {
    width: 100%;
  }
  .section-title {
    margin-top: 40px;
    font-size: 1.2em;
    font-weight: bold;
  }
  .subtotal, .total {
    font-weight: bold;
  }
  .notes {
    color: #555;
    font-size: 0.9em;
  }
  table col:nth-child(1) { width: 30%; }
  table col:nth-child(2) { width: 20%; }
  table col:nth-child(3) { width: 20%; }
  table col:nth-child(4) { width: 30%; }
</style>
<script>
function formatNumber(num) {
  if (!num || isNaN(num)) return '0';
  return num.toLocaleString('en-US', {maximumFractionDigits:0});
}

function recalculate() {
  // Inputs
  const acres = parseFloat(document.getElementById('inputAcres').value) || 0;
  const costPerAcre = parseFloat(document.getElementById('costPerAcre').value) || 0;
  const usablePercent = parseFloat(document.getElementById('selectUsable').value) || 0;
  const lotsPerAcre = parseFloat(document.getElementById('inputLotsPerAcre').value) || 0;
  const entitledLotPrice = parseFloat(document.getElementById('entitledLotPrice').value) || 0;
  const developedLotPrice = parseFloat(document.getElementById('developedLotPrice').value) || 0;
  const tapFee = parseFloat(document.getElementById('tapFee').value) || 0;
  const wellFee = parseFloat(document.getElementById('wellFee').value) || 0;
  const septicFee = parseFloat(document.getElementById('septicFee').value) || 0;
  const difficulty = document.getElementById('gradingDifficulty').value;
  const primeRate = parseFloat(document.getElementById('primeRate').value) || 0;
  const carryingMonths = parseFloat(document.getElementById('carryingMonths').value) || 12;
  // targetMargin was previously used, but now we don't have a dropdown. We'll just set a default:
  const targetMargin = 30;

  const totalLots = acres * usablePercent * lotsPerAcre;

  // Scenario Revenues
  const entitledRevenue = totalLots * entitledLotPrice;
  const developedRevenue = totalLots * developedLotPrice;

  // Land & Entitlement
  const landPurchaseTotal = costPerAcre * acres;
  const engineering = 25000;
  const surveying = 20000;
  const adminLegal = 30000;
  const environmental = 5000;
  const geoTests = 5000;
  const landEntitlementSubtotal = landPurchaseTotal + engineering + surveying + adminLegal + environmental + geoTests;

  // Grading costs per difficulty
  let gradingCostPerAcre = (difficulty === 'easy') ? 13000 : (difficulty === 'normal' ? 27500 : 55000);
  const clearingGrading = gradingCostPerAcre * acres;

  // Erosion control per difficulty
  let erosionCostPerAcre = (difficulty === 'easy') ? 4000 : (difficulty === 'normal' ? 5000 : 9500);
  const erosionControl = erosionCostPerAcre * acres;

  // Tap, well, septic fees (per lot)
  const tapFeesTotal = tapFee * totalLots;
  const wellFeesTotal = wellFee * totalLots;
  const septicFeesTotal = septicFee * totalLots;

  // Site Prep (developed scenario)
  const sitePrepDeveloped = clearingGrading + erosionControl + tapFeesTotal + wellFeesTotal + septicFeesTotal;

  // Road & Infrastructure (developed scenario)
  const roadConstruction = 300 * 5280;
  const lightingSignage = 50000;
  const waterSewer = 5000 * totalLots;
  const stormwater = 2000 * totalLots;
  const electricGas = 2000 * totalLots;
  const roadInfraDeveloped = roadConstruction + lightingSignage + waterSewer + stormwater + electricGas;

  // Lot Improvements (developed scenario)
  const leftoverAcres = acres * (1 - usablePercent);
  const landscaping = leftoverAcres * 7000;
  const serviceLaterals = 1000 * totalLots;
  const lotGradingFinish = 500 * totalLots;
  const commonAmenities = 50000;
  const lotImprovementsDeveloped = serviceLaterals + lotGradingFinish + commonAmenities + landscaping;

  // Soft Costs (developed scenario)
  const addlEng = 25000;
  const accountingLegal = 10000;
  const insurance = 5000;
  const softCostsBase = addlEng + accountingLegal + insurance; 

  // Hard costs (developed scenario)
  const hardCostsDeveloped = landEntitlementSubtotal + sitePrepDeveloped + roadInfraDeveloped + lotImprovementsDeveloped;

  // Contingency & Reserves (developed scenario)
  const contingency = hardCostsDeveloped * 0.10;
  const ownerReserve = 50000;
  const contingencySubtotal = contingency + ownerReserve;

  // Base cost before PM, marketing, financing (developed scenario)
  const baseCostNoPMNoMktNoFin = hardCostsDeveloped + softCostsBase + contingencySubtotal;

  // Project Management & Marketing
  // PM: 5% of developedRevenue, 0 for entitled
  const pmEntitled = 0;
  const pmDeveloped = developedRevenue * 0.05;

  // Marketing: 6% of scenario revenue
  const marketingEntitled = entitledRevenue * 0.06;
  const marketingDeveloped = developedRevenue * 0.06;

  // Financing (developed scenario)
  const financingSubtotal = (baseCostNoPMNoMktNoFin + pmDeveloped) * ((primeRate + 2)/100) * (carryingMonths / 12);

  // Total Costs
  // Entitled scenario: landEntitlementSubtotal + marketing
  const totalEntitledCost = landEntitlementSubtotal + marketingEntitled;
  const entitledProfit = entitledRevenue - totalEntitledCost;
  const entitledMargin = (totalEntitledCost > 0) ? (entitledProfit / totalEntitledCost) : 0;

  // Developed scenario: all included
  const totalDevelopedCost = baseCostNoPMNoMktNoFin + pmDeveloped + financingSubtotal + marketingDeveloped;
  const developedProfit = developedRevenue - totalDevelopedCost;
  const developedMargin = (totalDevelopedCost > 0) ? (developedProfit / totalDevelopedCost) : 0;

  // Land cost is purchase price, other costs is total costs minus land
  const entitledLandOnly = landPurchaseTotal;
  const entitledOtherCosts = totalEntitledCost - landPurchaseTotal;

  const developedLandOnly = landPurchaseTotal;
  const developedOtherCosts = totalDevelopedCost - landPurchaseTotal;

  // Update displayed values
  document.getElementById('totalLots').textContent = formatNumber(totalLots);

  // Land & Entitlement
  document.getElementById('landPurchaseCost').textContent = formatNumber(landPurchaseTotal);
  document.getElementById('engineering').textContent = formatNumber(engineering);
  document.getElementById('surveying').textContent = formatNumber(surveying);
  document.getElementById('adminLegal').textContent = formatNumber(adminLegal);
  document.getElementById('environmental').textContent = formatNumber(environmental);
  document.getElementById('geoTests').textContent = formatNumber(geoTests);
  document.getElementById('landEntSubtotalEnt').textContent = formatNumber(landEntitlementSubtotal);
  document.getElementById('landEntSubtotalDev').textContent = formatNumber(landEntitlementSubtotal);

  // Site Prep
  document.getElementById('clearingGradingEnt').textContent = formatNumber(0);
  document.getElementById('clearingGradingDev').textContent = formatNumber(clearingGrading);

  document.getElementById('erosionEnt').textContent = formatNumber(0);
  document.getElementById('erosionDev').textContent = formatNumber(erosionControl);

  document.getElementById('tapFeeEnt').textContent = formatNumber(0);
  document.getElementById('tapFeeDev').textContent = formatNumber(tapFeesTotal);

  document.getElementById('wellFeeEnt').textContent = formatNumber(0);
  document.getElementById('wellFeeDev').textContent = formatNumber(wellFeesTotal);

  document.getElementById('septicFeeEnt').textContent = formatNumber(0);
  document.getElementById('septicFeeDev').textContent = formatNumber(septicFeesTotal);

  document.getElementById('sitePrepEntSubtotal').textContent = formatNumber(0);
  document.getElementById('sitePrepDevSubtotal').textContent = formatNumber(sitePrepDeveloped);

  // Road & Infrastructure
  document.getElementById('roadConstEnt').textContent = formatNumber(0);
  document.getElementById('roadConstDev').textContent = formatNumber(roadConstruction);

  document.getElementById('lightingEnt').textContent = formatNumber(0);
  document.getElementById('lightingDev').textContent = formatNumber(lightingSignage);

  document.getElementById('waterSewerEnt').textContent = formatNumber(0);
  document.getElementById('waterSewerDev').textContent = formatNumber(waterSewer);

  document.getElementById('stormwaterEnt').textContent = formatNumber(0);
  document.getElementById('stormwaterDev').textContent = formatNumber(stormwater);

  document.getElementById('electricGasEnt').textContent = formatNumber(0);
  document.getElementById('electricGasDev').textContent = formatNumber(electricGas);

  document.getElementById('roadInfraEntSubtotal').textContent = formatNumber(0);
  document.getElementById('roadInfraDevSubtotal').textContent = formatNumber(roadInfraDeveloped);

  // Lot Improvements
  document.getElementById('serviceLateralsEnt').textContent = formatNumber(0);
  document.getElementById('serviceLateralsDev').textContent = formatNumber(serviceLaterals);

  document.getElementById('lotGradingFinishEnt').textContent = formatNumber(0);
  document.getElementById('lotGradingFinishDev').textContent = formatNumber(lotGradingFinish);

  document.getElementById('amenitiesEnt').textContent = formatNumber(0);
  document.getElementById('amenitiesDev').textContent = formatNumber(commonAmenities);

  document.getElementById('landscapingEnt').textContent = formatNumber(0);
  document.getElementById('landscapingDev').textContent = formatNumber(landscaping);

  document.getElementById('lotImpEntSubtotal').textContent = formatNumber(0);
  document.getElementById('lotImpDevSubtotal').textContent = formatNumber(lotImprovementsDeveloped);

  // Soft Costs
  document.getElementById('addlEngEnt').textContent = formatNumber(0);
  document.getElementById('addlEngDev').textContent = formatNumber(addlEng);

  document.getElementById('accountingLegalEnt').textContent = formatNumber(0);
  document.getElementById('accountingLegalDev').textContent = formatNumber(accountingLegal);

  document.getElementById('insuranceEnt').textContent = formatNumber(0);
  document.getElementById('insuranceDev').textContent = formatNumber(insurance);

  document.getElementById('softCostsEntSubtotal').textContent = formatNumber(0);
  document.getElementById('softCostsDevSubtotal').textContent = formatNumber(softCostsBase);

  // Contingency & Reserves
  document.getElementById('contingencyEnt').textContent = formatNumber(0);
  document.getElementById('contingencyDev').textContent = formatNumber(contingency);

  document.getElementById('ownerReserveEnt').textContent = formatNumber(0);
  document.getElementById('ownerReserveDev').textContent = formatNumber(ownerReserve);

  document.getElementById('contEntSubtotal').textContent = formatNumber(0);
  document.getElementById('contDevSubtotal').textContent = formatNumber(contingencySubtotal);

  // Financing
  document.getElementById('financingEnt').textContent = formatNumber(0);
  document.getElementById('financingDev').textContent = formatNumber(financingSubtotal);

  // PM & Marketing
  document.getElementById('pmEnt').textContent = formatNumber(pmEntitled);
  document.getElementById('pmDev').textContent = formatNumber(pmDeveloped);

  document.getElementById('marketingEnt').textContent = formatNumber(marketingEntitled);
  document.getElementById('marketingDev').textContent = formatNumber(marketingDeveloped);

  // Totals
  document.getElementById('totalEntitledCost').textContent = formatNumber(totalEntitledCost);
  document.getElementById('totalDevelopedCost').textContent = formatNumber(totalDevelopedCost);

  const perLotDev = (totalLots>0)?totalDevelopedCost/totalLots:0;
  document.getElementById('perLotCostDev').textContent = formatNumber(perLotDev);

  // Profit & Margin
  const entitledProfitText = formatNumber(entitledProfit);
  const developedProfitText = formatNumber(developedProfit);
  const entitledMarginPercent = (entitledMargin * 100).toFixed(2) + '%';
  const developedMarginPercent = (developedMargin * 100).toFixed(2) + '%';

  // Update scenario table with 6 columns: scenario, purchase price(land), costs, sales price, profit, profit margin
  document.getElementById('entitledLandCost').textContent = formatNumber(entitledLandOnly);
  document.getElementById('entitledOtherCosts').textContent = formatNumber(entitledOtherCosts);
  document.getElementById('entitledSalesPrice').textContent = formatNumber(entitledLotPrice);
  document.getElementById('entitledProfit').textContent = entitledProfitText;
  document.getElementById('entitledMargin').textContent = entitledMarginPercent;

  document.getElementById('developedLandCost').textContent = formatNumber(developedLandOnly);
  document.getElementById('developedOtherCosts').textContent = formatNumber(developedOtherCosts);
  document.getElementById('developedSalesPrice').textContent = formatNumber(developedLotPrice);
  document.getElementById('developedProfit').textContent = developedProfitText;
  document.getElementById('developedMargin').textContent = developedMarginPercent;
}
</script>
</head>
<body onload="recalculate()">

<h1>Subdivision Development Proforma</h1>

<div class="section-title">Inputs</div>
<table>
  <colgroup><col><col><col><col></colgroup>
  <!-- Inputs table content unchanged -->
  ...
</table>

<!-- All cost tables remain unchanged -->
<!-- ... -->

<!-- Updated scenario table with 6 columns -->
<table>
  <colgroup><col><col><col><col><col><col></colgroup>
  <tr>
    <th>Scenario</th>
    <th>Purchase Price (Land)</th>
    <th>Costs</th>
    <th>Sales Price to Builder</th>
    <th>Profit</th>
    <th>Profit Margin</th>
  </tr>
  <tr>
    <td>Sell Entitled Land</td>
    <td id="entitledLandCost"></td>
    <td id="entitledOtherCosts"></td>
    <td id="entitledSalesPrice"></td>
    <td id="entitledProfit"></td>
    <td id="entitledMargin"></td>
  </tr>
  <tr>
    <td>Sell Fully Developed Lots</td>
    <td id="developedLandCost"></td>
    <td id="developedOtherCosts"></td>
    <td id="developedSalesPrice"></td>
    <td id="developedProfit"></td>
    <td id="developedMargin"></td>
  </tr>
</table>

<p class="notes">Adjust values, formulas, and references as needed. Update the prime rate daily.</p>

</body>
</html>
